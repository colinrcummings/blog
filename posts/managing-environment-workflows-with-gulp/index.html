<!doctype html><html lang="en"><head><title data-react-helmet="true">Managing environment workflows with gulp.js</title><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta data-react-helmet="true" name="generator" content="Phenomic 0.21.1"/><meta data-react-helmet="true" property="og:site_name" content="blog"/><meta data-react-helmet="true" name="twitter:site" content="@colinrcummings"/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:title" content="Managing environment workflows with gulp.js"/><meta data-react-helmet="true" property="og:url" content="https://colinrcummings.github.io/blog/posts/managing-environment-workflows-with-gulp/"/><meta data-react-helmet="true" property="og:image" content="https://colinrcummings.github.io/blog/../../assets/images/posts/managing_environment_workflows_with_gulp/hero.jpg"/><meta data-react-helmet="true" property="og:description" content="Over the years, I&#x27;ve used a few different combinations of frameworks, libraries and tools, some of which come with environment workflows…"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="Managing environment workflows with gulp.js"/><meta data-react-helmet="true" name="twitter:creator" content="@colinrcummings"/><meta data-react-helmet="true" name="twitter:description" content="Over the years, I&#x27;ve used a few different combinations of frameworks, libraries and tools, some of which come with environment workflows…"/><meta data-react-helmet="true" name="twitter:image" content="https://colinrcummings.github.io/blog/../../assets/images/posts/managing_environment_workflows_with_gulp/hero.jpg"/><meta data-react-helmet="true" name="description" content="Over the years, I&#x27;ve used a few different combinations of frameworks, libraries and tools, some of which come with environment workflows…"/><link rel="stylesheet" href="/blog/phenomic.browser.61d377c0d8f179db61c7.css"/><script data-react-helmet="true" src="https://cdn.polyfill.io/v2/polyfill.min.js"></script></head><body><div id="phenomic"><div class="_1RdlK" data-reactroot="" data-reactid="1" data-react-checksum="488278509"><div hidden="" data-reactid="2"><!-- react-empty: 3 --><!-- react-empty: 4 --><style data-reactid="5">@-ms-viewport { width: device-width; }</style></div><header class="_2FSyU" data-reactid="6"><nav class="_3LSR3" data-reactid="7"><div class="_3AJay" data-reactid="8"><a class="UWcAH" href="/" data-reactid="9">Home</a></div><div class="_3X6jh" data-reactid="10"><a href="https://twitter.com/colinrcummings" class="UWcAH" data-reactid="11"><span class="SVGInline SVGInline--cleaned" data-reactid="12"><svg class="SVGInline-svg SVGInline--cleaned-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M24 4.557a9.83 9.83 0 0 1-2.828.775 4.932 4.932 0 0 0 2.165-2.724 9.864 9.864 0 0 1-3.127 1.195 4.916 4.916 0 0 0-3.594-1.555c-3.18 0-5.515 2.966-4.797 6.045A13.978 13.978 0 0 1 1.67 3.15a4.93 4.93 0 0 0 1.524 6.573 4.903 4.903 0 0 1-2.23-.616c-.053 2.28 1.582 4.415 3.95 4.89a4.935 4.935 0 0 1-2.224.084 4.928 4.928 0 0 0 4.6 3.42A9.9 9.9 0 0 1 0 19.54a13.94 13.94 0 0 0 7.548 2.212c9.142 0 14.307-7.72 13.995-14.646A10.025 10.025 0 0 0 24 4.556z"/></svg></span><!-- react-text: 13 -->Twitter<!-- /react-text --></a><a href="https://github.com/colinrcummings/blog" class="UWcAH" data-reactid="14"><span class="SVGInline SVGInline--cleaned" data-reactid="15"><svg class="SVGInline-svg SVGInline--cleaned-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.6.11.793-.26.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.09-.745.083-.73.083-.73 1.205.085 1.84 1.238 1.84 1.238 1.07 1.834 2.806 1.304 3.49.997.108-.776.42-1.306.763-1.605-2.665-.305-5.467-1.334-5.467-5.93 0-1.312.47-2.382 1.236-3.222-.125-.303-.536-1.524.116-3.176 0 0 1.008-.322 3.3 1.23A11.51 11.51 0 0 1 12 5.803c1.02.005 2.047.138 3.006.404 2.29-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.236 1.91 1.236 3.22 0 4.61-2.807 5.625-5.48 5.922.43.372.824 1.102.824 2.222v3.293c0 .32.192.694.8.576C20.567 21.796 24 17.3 24 12c0-6.627-5.373-12-12-12z"/></svg></span><!-- react-text: 16 -->GitHub<!-- /react-text --></a></div></nav></header><div class="_3SQKJ" data-reactid="17"><div class="_1V853" data-reactid="18"><!-- react-empty: 19 --><div class="_3dOrW" style="background:#111 url(../../assets/images/posts/managing_environment_workflows_with_gulp/hero.jpg) 50% 65% / cover;" data-reactid="20"><div class="_3kNGo" data-reactid="21"><div class="_15_CA" data-reactid="22"><h1 class="_2wBO_" data-reactid="23">Managing environment workflows with gulp.js</h1></div></div></div><div class="_15_CA _1yRWU" data-reactid="24"><div data-reactid="25"><header class="_1KeKU" data-reactid="26"><time data-reactid="27">Tue Oct 03 2017</time></header></div><div class="_2iPjb" data-reactid="28"><div class="phenomic-BodyContainer" data-reactid="29"><p>Over the years, I've used a few different combinations of frameworks, libraries and tools, some of which come with environment workflows out-of-the-box and others that do not. With the <a href="https://trends.google.com/trends/explore?date=all&q=%2Fm%2F0505cl,%2Fm%2F06y_qx,%2Fm%2F0bbxf89" target="_blank">rising popularity of Node.js</a>, the need to roll one's own environment workflows is also on the rise, as is the number of resources with which to do so. I recently give a presentation about this topic at one of the software development Meetups I attend; below is an overview of the presentation, the lion's share of which was a live demo.</p>
<p><a role="button" class="btn btn-default" href="http://colinrcummings.github.io/meetup-gulp" target="_blank">View Presentation</a></p>
<hr>
<h2 id="background"><a href="#background" class="phenomic-HeadingAnchor">#</a>Background</h2>
<p>I like writing code; I don't like performing repetitive tasks like manipulating files, migrating folders, running scripts, <i>et cetera</i>. Accordingly, I make optimizing develop, build and deploy workflows across development, test and production environments a priority in every project. Inevitably, this is a tradeoff between <a href="https://twitter.com/phillip_webb/status/705909774001377280?lang=en" target="_blank"> magic and boilerplate</a>.</p>
<p>When I was getting started with development, I used <a href="http://rubyonrails.org/" target="_blank">Ruby On Rails</a>, which is preconfigured with pretty good, albeit magic-laden, develop and build workflows for development and production environments that are powered by its <a href="http://guides.rubyonrails.org/asset_pipeline.html" target="_blank">Asset Pipeline</a>. Additionally, <a href="https://www.heroku.com/" target="_blank">Heroku</a> offers a nice <a href="https://devcenter.heroku.com/articles/getting-started-with-rails4#deploy-your-application-to-heroku" target="_blank">Rails deploy workflow</a> for test and production environments. If you've worked with Rails like this before, then you know that it's great... until it isn't.</p>
<div class="grid">
  <div class="col-4-12">
    <div class="text-center">
      <div style="display: inline-block; max-width: 100%;">
        <div class="text-left">
          <span class="small text-muted">
            <em>The good</em>
          </span>
        </div>
        <img class="img-rounded" src="../../assets/images/posts/managing_environment_workflows_with_gulp/asset_pipeline_good.jpg" alt="Welcome aboard. You're riding Ruby on Rails! (meme)"/>
      </div>
    </div>
  </div>
  <div class="col-4-12">
    <div class="text-center">
      <div style="display: inline-block; max-width: 100%;">
        <div class="text-left">
          <span class="small text-muted">
            <em>The bad</em>
          </span>
        </div>
        <img class="img-rounded" src="../../assets/images/posts/managing_environment_workflows_with_gulp/asset_pipeline_bad.jpg" alt="I don't always deploy Rails to Heroku, but when I do, I break the Asset Pipeline. (meme)"/>
      </div>
    </div>
  </div>
  <div class="col-4-12">
    <div class="text-center">
      <div style="display: inline-block; max-width: 100%;">
        <div class="text-left">
          <span class="small text-muted">
            <em>The ugly</em>
          </span>
        </div>
        <img class="img-rounded" src="../../assets/images/posts/managing_environment_workflows_with_gulp/asset_pipeline_ugly.jpg" alt="Asset Pipeline! (meme)"/>
      </div>
    </div>
  </div>
</div>
<p>While I still use Rails in some existing projects (including <a href="https://www.peakbucket.com/" target="_blank">PeakBucket</a>), I've come to prefer <a href="https://nodejs.org/" target="_blank">Node.js</a> when starting new ones. Node leaves configuration almost entirely up to the developer, but with freedom comes responsibility—and often boilerplate. Some tools, like <a href="https://github.com/facebookincubator/create-react-app" target="_blank">Create React App</a>, provide preconfigured (<i>i.e.</i> boilerplate-free) develop and build workflows for development and production environments with the option to "eject" and customize the configuration at any time. For more complex applications, however, you often need more control; for me, this is where <a href="https://gulpjs.com/" target="_blank">gulp.js</a> comes into play.</p>
<p>With over 3 million downloads a month, gulp needs little introduction. While it's not the only tool of its kind, nor is it as widely used as <a href="https://webpack.github.io/" target="_blank">webpack</a> (with over 8 million downloads a month), its flexibility, strong ecosystem and interoperability with other tools (including webpack) make it my choice for managing environment workflows in more complex applications.</p>
<hr>
<h2 id="example"><a href="#example" class="phenomic-HeadingAnchor">#</a>Example</h2>
<p>At work, I maintain a Node project that's an <a href="https://expressjs.com/" target="_blank">Express</a> application comprised of multiple single-page <a href="https://reactjs.org/" target="_blank">React</a>  applications. Configured like this, Express handles database connections, view/web service routes and user authentication server-side, while React handles user interactions client-side. Here are the workflows I've configured for this application:</p>
<h3 id="develop"><a href="#develop" class="phenomic-HeadingAnchor">#</a>Develop</h3>
<p>Optimized for developer experience, the develop workflow is tuned to minimize wait time and manual tasks in order to maximize code quality and output in the development environment. On startup, it copies static files, transpiles SASS files and compiles JS(X) files into the public directory. It uses <a href="https://github.com/remy/nodemon" target="_blank">nodemon</a> for a runtime, which automatically restarts the server when watched files change, and uses individual database connections per web service request to avoid acquiring additional connections with each restart. Because webpack bundles the view scripts, it takes advantage of <a href=" https://webpack.github.io/docs/hot-module-replacement.html" target="_blank">Hot Module Replacement</a> (including <a href="https://gaearon.github.io/react-hot-loader/" target="_blank">React Hot Loader</a>) in addition to <a href="https://github.com/webpack-contrib/webpack-bundle-analyzer" target="_blank">Webpack Bundle Analyzer</a>.</p>
<div class="grid">
  <div class="col-2-12 hide-on-mobile"></div>
  <div class="col-8-12">
    <div class="text-center" style="margin-top: 5px;">
      <div style="display: inline-block; max-width: 100%;">
        <img class="img-rounded" src="../../assets/images/posts/managing_environment_workflows_with_gulp/dev.jpg" alt="Develop workflow (console screenshot)"/>
      </div>
    </div>
  </div>
  <div class="col-2-12 hide-on-mobile"></div>
</div>
<h3 id="build"><a href="#build" class="phenomic-HeadingAnchor">#</a>Build</h3>
<p>One of 12 items on <a href="https://www.joelonsoftware.com/2000/08/09/the-joel-test-12-steps-to-better-code/" target="_blank">The Joel Test</a>, making a build in one step, for use in either the test or production environment, is what this workflow is all about. Prior to making a build, it runs a unit test suite, which covers all aspects of the application (including database connections, web service calls, business logic and user authentication/interaction). In addition to copying/transpiling/compiling minified public assets, it also copies all of the other files required for running the application (models, views, controllers, routes, <i>et cetera</i>) into a build directory.</p>
<div class="grid">
  <div class="col-2-12 hide-on-mobile"></div>
  <div class="col-8-12">
    <div class="text-center" style="margin-top: 5px;">
      <div style="display: inline-block; max-width: 100%;">
        <img class="img-rounded" src="../../assets/images/posts/managing_environment_workflows_with_gulp/build.jpg" alt="Build workflow (console screenshot)"/>
      </div>
    </div>
  </div>
  <div class="col-2-12 hide-on-mobile"></div>
</div>
<h3 id="deploy"><a href="#deploy" class="phenomic-HeadingAnchor">#</a>Deploy</h3>
<p>One additional piece of complexity with this application is that it's deployed to a Windows Server hosted on a VPN. My goal in creating this workflow was to replicate the ease of <code>$ git push heroku master</code>, which I've enjoyed with other applications. It's split into two commands: one run locally and another run on the server, which leaves the flexibility to deploy to multiple environments server-side.</p>
<p>Locally, the deploy workflow runs the build workflow, zips the build directory and coppies the zipped build directory to the server.</p>
<div class="grid">
  <div class="col-2-12 hide-on-mobile"></div>
  <div class="col-8-12">
    <div class="text-center" style="margin-top: 5px;">
      <div style="display: inline-block; max-width: 100%;">
        <img class="img-rounded" src="../../assets/images/posts/managing_environment_workflows_with_gulp/deploy-local.jpg" alt="Deploy workflow locally (console screenshot)"/>
      </div>
    </div>
  </div>
  <div class="col-2-12 hide-on-mobile"></div>
</div>
<p>On the server, the build can be deployed to either the test or production environment:</p>
<p>In the test environment, the deploy workflow on the server unzips the zipped build directory, migrates build files and updates node modules. The test environment runtime is started manually as a process attached to the console (<i>i.e.</i> <code>$ npm start</code>).</p>
<div class="grid">
  <div class="col-2-12 hide-on-mobile"></div>
  <div class="col-8-12">
    <div class="text-center" style="margin-top: 5px;">
      <div style="display: inline-block; max-width: 100%;">
        <img class="img-rounded" src="../../assets/images/posts/managing_environment_workflows_with_gulp/deploy-server-test.jpg" alt="Test deploy workflow on the server (console screenshot)"/>
      </div>
    </div>
  </div>
  <div class="col-2-12 hide-on-mobile"></div>
</div>
<p>In the production environment, the deploy workflow on the server unzips the zipped build directory, performs a database backup, stops the runtime daemon process, migrates build files, updates node modules and starts the runtime daemon process. The production environment runtime is a native Windows service courtesy of the <a href="https://github.com/coreybutler/node-windows/" target="_blank">node-windows</a> module.</p>
<div class="grid">
  <div class="col-2-12 hide-on-mobile"></div>
  <div class="col-8-12">
    <div class="text-center" style="margin-top: 5px;">
      <div style="display: inline-block; max-width: 100%;">
        <img class="img-rounded" src="../../assets/images/posts/managing_environment_workflows_with_gulp/deploy-server-prod.jpg" alt="Production deploy workflow on the server (console screenshot)"/>
      </div>
    </div>
  </div>
  <div class="col-2-12 hide-on-mobile"></div>
</div>
<hr>
<h2 id="feedback"><a href="#feedback" class="phenomic-HeadingAnchor">#</a>Feedback</h2>
<p>Have questions, comments or suggestions? Reach out to me on Twitter (<a href="https://twitter.com/colinrcummings">@colinrcummings</a>).</p>
<p>— Colin</p>
</div></div><hr data-reactid="30"/><div data-reactid="31"><h2 class="_3WIUg" data-reactid="32">Latest Posts</h2><div data-reactid="33"><ul class="_2p_La" data-reactid="34"><li data-reactid="35"><div class="cTqJo" data-reactid="36"><a class="_2zasl" href="/posts/managing-environment-workflows-with-gulp/" data-reactid="37">Managing environment workflows with gulp.js</a><div class="_1lRdo" data-reactid="38"><time data-reactid="39">Tue Oct 03 2017</time></div><div class="_2gmoH" data-reactid="40"><!-- react-text: 41 -->Over the years, I&#x27;ve used a few different combinations of frameworks, libraries and tools, some of which come with environment workflows…<!-- /react-text --><!-- react-text: 42 --> <!-- /react-text --></div><a class="_2TyE4" href="/posts/managing-environment-workflows-with-gulp/" data-reactid="43"><span role="button" class="_2iwpL Wg0EN" data-reactid="44">Read More →</span></a></div></li><li data-reactid="45"><div class="cTqJo" data-reactid="46"><a class="_2zasl" href="/posts/introduction-to-react/" data-reactid="47">Introduction to React.js</a><div class="_1lRdo" data-reactid="48"><time data-reactid="49">Wed May 17 2017</time></div><div class="_2gmoH" data-reactid="50"><!-- react-text: 51 -->I&#x27;ve been using React for a few years now. If you read my previous post, then you know that it&#x27;s my go-to library for creating user…<!-- /react-text --><!-- react-text: 52 --> <!-- /react-text --></div><a class="_2TyE4" href="/posts/introduction-to-react/" data-reactid="53"><span role="button" class="_2iwpL Wg0EN" data-reactid="54">Read More →</span></a></div></li><li data-reactid="55"><div class="cTqJo" data-reactid="56"><a class="_2zasl" href="/posts/a-wedding-website/" data-reactid="57">A Wedding Website</a><div class="_1lRdo" data-reactid="58"><time data-reactid="59">Sat Feb 25 2017</time></div><div class="_2gmoH" data-reactid="60"><!-- react-text: 61 -->My sister&#x27;s getting married. During a discussion about how to handle RSVPs for the big day, I floated the option of doing it online. This…<!-- /react-text --><!-- react-text: 62 --> <!-- /react-text --></div><a class="_2TyE4" href="/posts/a-wedding-website/" data-reactid="63"><span role="button" class="_2iwpL Wg0EN" data-reactid="64">Read More →</span></a></div></li></ul></div></div></div></div></div><footer class="_1BvTd" data-reactid="65"><p data-reactid="66"><a href="https://phenomic.io" class="_1a1P_" data-reactid="67"><!-- react-text: 68 -->Website generated with <!-- /react-text --><span class="_2b3UD" data-reactid="69">&lt;Phenomic /&gt;</span></a></p></footer></div></div><script>window.__COLLECTION__ = [{"layout":"PageError","route":"404.html","description":"","__filename":"404.md","__url":"/404.html","__resourceUrl":"/404.html","__dataUrl":"/404.html.7f6093458561a2a9bb2178ef2cba0f0f.json"},{"title":"Blog | Colin Cummings","layout":"Homepage","hero":"assets/images/index/hero.jpg","cta":{"label":"Portfolio","link":"https://colinrcummings.github.io/"},"description":"* * *","__filename":"index.md","__url":"/","__resourceUrl":"/index.html","__dataUrl":"/index.html.e8b1aa44ae5a768ec6418ad89e505149.json"},{"title":"A Wedding Website","date":"2017-02-26T00:00:00.000Z","layout":"Post","hero":"../../assets/images/posts/a_wedding_website/hero.jpg","description":"My sister's getting married. During a discussion about how to handle RSVPs for the big day, I floated the option of doing it online. This…","__filename":"posts/a-wedding-website.md","__url":"/posts/a-wedding-website/","__resourceUrl":"/posts/a-wedding-website/index.html","__dataUrl":"/posts/a-wedding-website/index.html.08113c1d5a7dcb7f42a4fb1e6383ffe3.json"},{"title":"Introduction to React.js","date":"2017-05-18T00:00:00.000Z","layout":"Post","hero":"../../assets/images/posts/introduction_to_react/hero.jpg","description":"I've been using React for a few years now. If you read my previous post, then you know that it's my go-to library for creating user…","__filename":"posts/introduction-to-react.md","__url":"/posts/introduction-to-react/","__resourceUrl":"/posts/introduction-to-react/index.html","__dataUrl":"/posts/introduction-to-react/index.html.6cfde837d4048c2f8fc313cad88810bb.json"},{"title":"Managing environment workflows with gulp.js","date":"2017-10-3","layout":"Post","hero":"../../assets/images/posts/managing_environment_workflows_with_gulp/hero.jpg","description":"Over the years, I've used a few different combinations of frameworks, libraries and tools, some of which come with environment workflows…","__filename":"posts/managing-environment-workflows-with-gulp.md","__url":"/posts/managing-environment-workflows-with-gulp/","__resourceUrl":"/posts/managing-environment-workflows-with-gulp/index.html","__dataUrl":"/posts/managing-environment-workflows-with-gulp/index.html.7ebf36e72f5227aa32635db9a28144d3.json"}];window.__INITIAL_STATE__ = {"pages":{"/posts/managing-environment-workflows-with-gulp/":{"head":{"title":"Managing environment workflows with gulp.js","date":"2017-10-3","layout":"Post","hero":"../../assets/images/posts/managing_environment_workflows_with_gulp/hero.jpg","description":"Over the years, I've used a few different combinations of frameworks, libraries and tools, some of which come with environment workflows…"},"body":"<p>Over the years, I've used a few different combinations of frameworks, libraries and tools, some of which come with environment workflows out-of-the-box and others that do not. With the <a href=\"https://trends.google.com/trends/explore?date=all&q=%2Fm%2F0505cl,%2Fm%2F06y_qx,%2Fm%2F0bbxf89\" target=\"_blank\">rising popularity of Node.js</a>, the need to roll one's own environment workflows is also on the rise, as is the number of resources with which to do so. I recently give a presentation about this topic at one of the software development Meetups I attend; below is an overview of the presentation, the lion's share of which was a live demo.</p>\n<p><a role=\"button\" class=\"btn btn-default\" href=\"http://colinrcummings.github.io/meetup-gulp\" target=\"_blank\">View Presentation</a></p>\n<hr>\n<h2 id=\"background\"><a href=\"#background\" class=\"phenomic-HeadingAnchor\">#</a>Background</h2>\n<p>I like writing code; I don't like performing repetitive tasks like manipulating files, migrating folders, running scripts, <i>et cetera</i>. Accordingly, I make optimizing develop, build and deploy workflows across development, test and production environments a priority in every project. Inevitably, this is a tradeoff between <a href=\"https://twitter.com/phillip_webb/status/705909774001377280?lang=en\" target=\"_blank\"> magic and boilerplate</a>.</p>\n<p>When I was getting started with development, I used <a href=\"http://rubyonrails.org/\" target=\"_blank\">Ruby On Rails</a>, which is preconfigured with pretty good, albeit magic-laden, develop and build workflows for development and production environments that are powered by its <a href=\"http://guides.rubyonrails.org/asset_pipeline.html\" target=\"_blank\">Asset Pipeline</a>. Additionally, <a href=\"https://www.heroku.com/\" target=\"_blank\">Heroku</a> offers a nice <a href=\"https://devcenter.heroku.com/articles/getting-started-with-rails4#deploy-your-application-to-heroku\" target=\"_blank\">Rails deploy workflow</a> for test and production environments. If you've worked with Rails like this before, then you know that it's great... until it isn't.</p>\n<div class=\"grid\">\n  <div class=\"col-4-12\">\n    <div class=\"text-center\">\n      <div style=\"display: inline-block; max-width: 100%;\">\n        <div class=\"text-left\">\n          <span class=\"small text-muted\">\n            <em>The good</em>\n          </span>\n        </div>\n        <img class=\"img-rounded\" src=\"../../assets/images/posts/managing_environment_workflows_with_gulp/asset_pipeline_good.jpg\" alt=\"Welcome aboard. You're riding Ruby on Rails! (meme)\"/>\n      </div>\n    </div>\n  </div>\n  <div class=\"col-4-12\">\n    <div class=\"text-center\">\n      <div style=\"display: inline-block; max-width: 100%;\">\n        <div class=\"text-left\">\n          <span class=\"small text-muted\">\n            <em>The bad</em>\n          </span>\n        </div>\n        <img class=\"img-rounded\" src=\"../../assets/images/posts/managing_environment_workflows_with_gulp/asset_pipeline_bad.jpg\" alt=\"I don't always deploy Rails to Heroku, but when I do, I break the Asset Pipeline. (meme)\"/>\n      </div>\n    </div>\n  </div>\n  <div class=\"col-4-12\">\n    <div class=\"text-center\">\n      <div style=\"display: inline-block; max-width: 100%;\">\n        <div class=\"text-left\">\n          <span class=\"small text-muted\">\n            <em>The ugly</em>\n          </span>\n        </div>\n        <img class=\"img-rounded\" src=\"../../assets/images/posts/managing_environment_workflows_with_gulp/asset_pipeline_ugly.jpg\" alt=\"Asset Pipeline! (meme)\"/>\n      </div>\n    </div>\n  </div>\n</div>\n<p>While I still use Rails in some existing projects (including <a href=\"https://www.peakbucket.com/\" target=\"_blank\">PeakBucket</a>), I've come to prefer <a href=\"https://nodejs.org/\" target=\"_blank\">Node.js</a> when starting new ones. Node leaves configuration almost entirely up to the developer, but with freedom comes responsibility—and often boilerplate. Some tools, like <a href=\"https://github.com/facebookincubator/create-react-app\" target=\"_blank\">Create React App</a>, provide preconfigured (<i>i.e.</i> boilerplate-free) develop and build workflows for development and production environments with the option to \"eject\" and customize the configuration at any time. For more complex applications, however, you often need more control; for me, this is where <a href=\"https://gulpjs.com/\" target=\"_blank\">gulp.js</a> comes into play.</p>\n<p>With over 3 million downloads a month, gulp needs little introduction. While it's not the only tool of its kind, nor is it as widely used as <a href=\"https://webpack.github.io/\" target=\"_blank\">webpack</a> (with over 8 million downloads a month), its flexibility, strong ecosystem and interoperability with other tools (including webpack) make it my choice for managing environment workflows in more complex applications.</p>\n<hr>\n<h2 id=\"example\"><a href=\"#example\" class=\"phenomic-HeadingAnchor\">#</a>Example</h2>\n<p>At work, I maintain a Node project that's an <a href=\"https://expressjs.com/\" target=\"_blank\">Express</a> application comprised of multiple single-page <a href=\"https://reactjs.org/\" target=\"_blank\">React</a>  applications. Configured like this, Express handles database connections, view/web service routes and user authentication server-side, while React handles user interactions client-side. Here are the workflows I've configured for this application:</p>\n<h3 id=\"develop\"><a href=\"#develop\" class=\"phenomic-HeadingAnchor\">#</a>Develop</h3>\n<p>Optimized for developer experience, the develop workflow is tuned to minimize wait time and manual tasks in order to maximize code quality and output in the development environment. On startup, it copies static files, transpiles SASS files and compiles JS(X) files into the public directory. It uses <a href=\"https://github.com/remy/nodemon\" target=\"_blank\">nodemon</a> for a runtime, which automatically restarts the server when watched files change, and uses individual database connections per web service request to avoid acquiring additional connections with each restart. Because webpack bundles the view scripts, it takes advantage of <a href=\" https://webpack.github.io/docs/hot-module-replacement.html\" target=\"_blank\">Hot Module Replacement</a> (including <a href=\"https://gaearon.github.io/react-hot-loader/\" target=\"_blank\">React Hot Loader</a>) in addition to <a href=\"https://github.com/webpack-contrib/webpack-bundle-analyzer\" target=\"_blank\">Webpack Bundle Analyzer</a>.</p>\n<div class=\"grid\">\n  <div class=\"col-2-12 hide-on-mobile\"></div>\n  <div class=\"col-8-12\">\n    <div class=\"text-center\" style=\"margin-top: 5px;\">\n      <div style=\"display: inline-block; max-width: 100%;\">\n        <img class=\"img-rounded\" src=\"../../assets/images/posts/managing_environment_workflows_with_gulp/dev.jpg\" alt=\"Develop workflow (console screenshot)\"/>\n      </div>\n    </div>\n  </div>\n  <div class=\"col-2-12 hide-on-mobile\"></div>\n</div>\n<h3 id=\"build\"><a href=\"#build\" class=\"phenomic-HeadingAnchor\">#</a>Build</h3>\n<p>One of 12 items on <a href=\"https://www.joelonsoftware.com/2000/08/09/the-joel-test-12-steps-to-better-code/\" target=\"_blank\">The Joel Test</a>, making a build in one step, for use in either the test or production environment, is what this workflow is all about. Prior to making a build, it runs a unit test suite, which covers all aspects of the application (including database connections, web service calls, business logic and user authentication/interaction). In addition to copying/transpiling/compiling minified public assets, it also copies all of the other files required for running the application (models, views, controllers, routes, <i>et cetera</i>) into a build directory.</p>\n<div class=\"grid\">\n  <div class=\"col-2-12 hide-on-mobile\"></div>\n  <div class=\"col-8-12\">\n    <div class=\"text-center\" style=\"margin-top: 5px;\">\n      <div style=\"display: inline-block; max-width: 100%;\">\n        <img class=\"img-rounded\" src=\"../../assets/images/posts/managing_environment_workflows_with_gulp/build.jpg\" alt=\"Build workflow (console screenshot)\"/>\n      </div>\n    </div>\n  </div>\n  <div class=\"col-2-12 hide-on-mobile\"></div>\n</div>\n<h3 id=\"deploy\"><a href=\"#deploy\" class=\"phenomic-HeadingAnchor\">#</a>Deploy</h3>\n<p>One additional piece of complexity with this application is that it's deployed to a Windows Server hosted on a VPN. My goal in creating this workflow was to replicate the ease of <code>$ git push heroku master</code>, which I've enjoyed with other applications. It's split into two commands: one run locally and another run on the server, which leaves the flexibility to deploy to multiple environments server-side.</p>\n<p>Locally, the deploy workflow runs the build workflow, zips the build directory and coppies the zipped build directory to the server.</p>\n<div class=\"grid\">\n  <div class=\"col-2-12 hide-on-mobile\"></div>\n  <div class=\"col-8-12\">\n    <div class=\"text-center\" style=\"margin-top: 5px;\">\n      <div style=\"display: inline-block; max-width: 100%;\">\n        <img class=\"img-rounded\" src=\"../../assets/images/posts/managing_environment_workflows_with_gulp/deploy-local.jpg\" alt=\"Deploy workflow locally (console screenshot)\"/>\n      </div>\n    </div>\n  </div>\n  <div class=\"col-2-12 hide-on-mobile\"></div>\n</div>\n<p>On the server, the build can be deployed to either the test or production environment:</p>\n<p>In the test environment, the deploy workflow on the server unzips the zipped build directory, migrates build files and updates node modules. The test environment runtime is started manually as a process attached to the console (<i>i.e.</i> <code>$ npm start</code>).</p>\n<div class=\"grid\">\n  <div class=\"col-2-12 hide-on-mobile\"></div>\n  <div class=\"col-8-12\">\n    <div class=\"text-center\" style=\"margin-top: 5px;\">\n      <div style=\"display: inline-block; max-width: 100%;\">\n        <img class=\"img-rounded\" src=\"../../assets/images/posts/managing_environment_workflows_with_gulp/deploy-server-test.jpg\" alt=\"Test deploy workflow on the server (console screenshot)\"/>\n      </div>\n    </div>\n  </div>\n  <div class=\"col-2-12 hide-on-mobile\"></div>\n</div>\n<p>In the production environment, the deploy workflow on the server unzips the zipped build directory, performs a database backup, stops the runtime daemon process, migrates build files, updates node modules and starts the runtime daemon process. The production environment runtime is a native Windows service courtesy of the <a href=\"https://github.com/coreybutler/node-windows/\" target=\"_blank\">node-windows</a> module.</p>\n<div class=\"grid\">\n  <div class=\"col-2-12 hide-on-mobile\"></div>\n  <div class=\"col-8-12\">\n    <div class=\"text-center\" style=\"margin-top: 5px;\">\n      <div style=\"display: inline-block; max-width: 100%;\">\n        <img class=\"img-rounded\" src=\"../../assets/images/posts/managing_environment_workflows_with_gulp/deploy-server-prod.jpg\" alt=\"Production deploy workflow on the server (console screenshot)\"/>\n      </div>\n    </div>\n  </div>\n  <div class=\"col-2-12 hide-on-mobile\"></div>\n</div>\n<hr>\n<h2 id=\"feedback\"><a href=\"#feedback\" class=\"phenomic-HeadingAnchor\">#</a>Feedback</h2>\n<p>Have questions, comments or suggestions? Reach out to me on Twitter (<a href=\"https://twitter.com/colinrcummings\">@colinrcummings</a>).</p>\n<p>— Colin</p>\n","__filename":"posts/managing-environment-workflows-with-gulp.md","__url":"/posts/managing-environment-workflows-with-gulp/","__resourceUrl":"/posts/managing-environment-workflows-with-gulp/index.html","__dataUrl":"/posts/managing-environment-workflows-with-gulp/index.html.7ebf36e72f5227aa32635db9a28144d3.json","type":"Post"}}}</script><script src="/blog/phenomic.browser.61d377c0d8f179db61c7.js"></script></body></html>