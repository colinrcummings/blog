{"data":{"site":{"siteMetadata":{"title":"<Blog />","author":"Colin Cummings"}},"markdownRemark":{"id":"eb57b941-2582-5353-a23d-c36741719820","excerpt":"Over the years, I’ve used a few different combinations of frameworks, libraries and tools, some of which come with environment workflows out-of-the-box and…","html":"<p>Over the years, I’ve used a few different combinations of frameworks, libraries and tools, some of which come with environment workflows out-of-the-box and others that do not. With the <a href=\"https://trends.google.com/trends/explore?date=all&#x26;q=%2Fm%2F0505cl,%2Fm%2F06y_qx,%2Fm%2F0bbxf89\">rising popularity of Node.js</a>, the need to roll one’s own environment workflows is also on the rise, as is the number of resources with which to do so. I recently give a presentation about this topic at one of the software development Meetups I attend; below is an overview of the presentation, the lion’s share of which was a live demo.</p>\n<p><a href=\"http://colinrcummings.github.io/meetup-gulp\">View Presentation</a></p>\n<hr>\n<h2>Background</h2>\n<p>I like writing code; I don’t like performing repetitive tasks like manipulating files, migrating folders, running scripts, <em>et cetera</em>. Accordingly, I make optimizing develop, build and deploy workflows across development, test and production environments a priority in every project. Inevitably, this is a tradeoff between <a href=\"https://twitter.com/phillip_webb/status/705909774001377280?lang=en\">magic and boilerplate</a>.</p>\n<p>When I was getting started with development, I used <a href=\"http://rubyonrails.org/\">Ruby On Rails</a>, which is preconfigured with pretty good, albeit magic-laden, develop and build workflows for development and production environments that are powered by its <a href=\"http://guides.rubyonrails.org/asset_pipeline.html\">Asset Pipeline</a>. Additionally, <a href=\"https://www.heroku.com/\">Heroku</a> offers a nice <a href=\"https://devcenter.heroku.com/articles/getting-started-with-rails4#deploy-your-application-to-heroku\">Rails deploy workflow</a> for test and production environments. If you’ve worked with Rails like this before, then you know that it’s great… until it isn’t.</p>\n<div class=\"gatsby-highlight\" data-language=\"grid|3\"><pre class=\"language-grid|3\"><code class=\"language-grid|3\">![Welcome aboard. You&#39;re riding Ruby on Rails! (meme)](./images/asset_pipeline_good.jpg)\n![I don&#39;t always deploy Rails to Heroku, but when I do, I break the Asset Pipeline. (meme)](./images/asset_pipeline_bad.jpg)\n\n![Asset Pipeline! (meme)](./images/asset_pipeline_ugly.jpg)</code></pre></div>\n<p>While I still use Rails in some existing projects (including <a href=\"https://www.peakbucket.com/\">PeakBucket</a>), I’ve come to prefer <a href=\"https://nodejs.org/\">Node.js</a> when starting new ones. Node leaves configuration almost entirely up to the developer, but with freedom comes responsibility—and often boilerplate. Some tools, like <a href=\"https://github.com/facebookincubator/create-react-app\">Create React App</a>, provide preconfigured (<em>i.e.</em> boilerplate-free) develop and build workflows for development and production environments with the option to “eject” and customize the configuration at any time. For more complex applications, however, you often need more control; for me, this is where <a href=\"https://gulpjs.com/\">gulp.js</a> comes into play.</p>\n<p>With over 3 million downloads a month, gulp needs little introduction. While it’s not the only tool of its kind, nor is it as widely used as <a href=\"https://webpack.github.io/\">webpack</a> (with over 8 million downloads a month), its flexibility, strong ecosystem and interoperability with other tools (including webpack) make it my choice for managing environment workflows in more complex applications.</p>\n<hr>\n<h2>Example</h2>\n<p>At work, I maintain a Node project that’s an <a href=\"https://expressjs.com/\">Express</a> application comprised of multiple single-page <a href=\"https://reactjs.org/\">React</a> applications. Configured like this, Express handles database connections, view/web service routes and user authentication server-side, while React handles user interactions client-side. Here are the workflows I’ve configured for this application:</p>\n<h3>Develop</h3>\n<p>Optimized for developer experience, the develop workflow is tuned to minimize wait time and manual tasks in order to maximize code quality and output in the development environment. On startup, it copies static files, transpiles SASS files and compiles JS(X) files into the public directory. It uses <a href=\"https://github.com/remy/nodemon\">nodemon</a> for a runtime, which automatically restarts the server when watched files change, and uses individual database connections per web service request to avoid acquiring additional connections with each restart (the application uses database pools in other environments). Because webpack bundles the view scripts, it also takes advantage of <a href=\"https://webpack.github.io/docs/hot-module-replacement.html\">Hot Module Replacement</a> (including <a href=\"https://gaearon.github.io/react-hot-loader/\">React Hot Loader</a>) in addition to <a href=\"https://github.com/webpack-contrib/webpack-bundle-analyzer\">Webpack Bundle Analyzer</a>.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2859e82b26becbeff3b2f0cce757d10c/e8aab/dev.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 92.78523489932886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAATABQDASIAAhEBAxEB/8QAGAABAQADAAAAAAAAAAAAAAAAAAMBAgX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHjSvImyLyDQH//xAAYEAADAQEAAAAAAAAAAAAAAAAAARARIf/aAAgBAQABBQLB1nI5/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAFBABAAAAAAAAAAAAAAAAAAAAMP/aAAgBAQAGPwIf/8QAHBAAAgEFAQAAAAAAAAAAAAAAAAEQESExYXGR/9oACAEBAAE/IaWWTu2dPweJf//aAAwDAQACAAMAAAAQAMAA/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPxAf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPxAf/8QAHxAAAgICAQUAAAAAAAAAAAAAAREAITHBEEFhgZHw/9oACAEBAAE/ECABeNQHSHri0Flagh+NQMXwbladoIWBjpx//9k='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Develop workflow (console screenshot)\"\n        title=\"\"\n        src=\"/static/2859e82b26becbeff3b2f0cce757d10c/f8fb9/dev.jpg\"\n        srcset=\"/static/2859e82b26becbeff3b2f0cce757d10c/e8976/dev.jpg 148w,\n/static/2859e82b26becbeff3b2f0cce757d10c/63df2/dev.jpg 295w,\n/static/2859e82b26becbeff3b2f0cce757d10c/f8fb9/dev.jpg 590w,\n/static/2859e82b26becbeff3b2f0cce757d10c/e8aab/dev.jpg 596w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h3>Build</h3>\n<p>One of 12 items on <a href=\"https://www.joelonsoftware.com/2000/08/09/the-joel-test-12-steps-to-better-code/\">The Joel Test</a>, making a build in one step, for use in either the test or production environment, is what this workflow is all about. Prior to making a build, it runs a unit test suite, which covers all aspects of the application (including database connections, web service calls, business logic and user authentication/interaction). In addition to copying/transpiling/compiling minified public assets, it also copies all of the other files required for running the application (models, views, controllers, routes, <em>et cetera</em>) into a build directory.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f632659a3ac1460dac5b329047e379cd/e8aab/build.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 148.65771812080538%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAeABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAEDAgX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHjSaMjC0rTJjD/xAAXEAADAQAAAAAAAAAAAAAAAAAAAREQ/9oACAEBAAEFAoPLsQ1tgz//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAUEAEAAAAAAAAAAAAAAAAAAAAw/9oACAEBAAY/Ak//xAAaEAADAQEBAQAAAAAAAAAAAAAAAREhEEFh/9oACAEBAAE/IYnVD0h8DTOJYR4o1Z//2gAMAwEAAgADAAAAEKDFDP/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8QH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8QH//EAB4QAQACAQQDAAAAAAAAAAAAAAEAESEQMUFxgZHw/9oACAEBAAE/EFxg2iBqjxorsnqBGWd5cZXxEK7OLiU5lYMWchEANxyzL0HU/9k='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Build workflow (console screenshot)\"\n        title=\"\"\n        src=\"/static/f632659a3ac1460dac5b329047e379cd/f8fb9/build.jpg\"\n        srcset=\"/static/f632659a3ac1460dac5b329047e379cd/e8976/build.jpg 148w,\n/static/f632659a3ac1460dac5b329047e379cd/63df2/build.jpg 295w,\n/static/f632659a3ac1460dac5b329047e379cd/f8fb9/build.jpg 590w,\n/static/f632659a3ac1460dac5b329047e379cd/e8aab/build.jpg 596w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h3>Deploy</h3>\n<p>One additional piece of complexity with this application is that it’s deployed to a Windows Server hosted on a VPN. My goal in creating this workflow was to replicate the ease of <code class=\"language-text\">$ git push heroku master</code>, which I’ve enjoyed with other applications. It’s split into two commands: one run locally and another run on the server, which leaves the flexibility to deploy to multiple environments server-side.</p>\n<p>Locally, the deploy workflow runs the build workflow, zips the build directory and coppies the zipped build directory to the server.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/06cc3f61af05a67b2e531d75c294ed7a/e8aab/deploy-local.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 183.72483221476512%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAlABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAMCAQX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHxZ7wZBadcknReQYB//8QAGRAAAwEBAQAAAAAAAAAAAAAAAAEQERIg/9oACAEBAAEFAsu3kfhmDn//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AV//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AV//xAAWEAADAAAAAAAAAAAAAAAAAAAgITD/2gAIAQEABj8Ckx//xAAbEAACAgMBAAAAAAAAAAAAAAAAAREhEDFBcf/aAAgBAQABPyHUdZuyD0STJFpFdWQmiD4Vx//aAAwDAQACAAMAAAAQgMI8cA//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EF//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/EF//xAAeEAACAgICAwAAAAAAAAAAAAABEQAhEEExYVGRof/aAAgBAQABPxAuFtRaJesE9D7H0uNEIpIBQbW43mCS7ndiMQCQdIZmXXZgSB0lxAaavH//2Q=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Deploy workflow locally (console screenshot)\"\n        title=\"\"\n        src=\"/static/06cc3f61af05a67b2e531d75c294ed7a/f8fb9/deploy-local.jpg\"\n        srcset=\"/static/06cc3f61af05a67b2e531d75c294ed7a/e8976/deploy-local.jpg 148w,\n/static/06cc3f61af05a67b2e531d75c294ed7a/63df2/deploy-local.jpg 295w,\n/static/06cc3f61af05a67b2e531d75c294ed7a/f8fb9/deploy-local.jpg 590w,\n/static/06cc3f61af05a67b2e531d75c294ed7a/e8aab/deploy-local.jpg 596w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>On the server, the build can be deployed to either the test or production environment:</p>\n<p>In the test environment, the deploy workflow on the server unzips the zipped build directory, migrates build files and updates node modules. The test environment runtime is started manually as a process attached to the console (<em>i.e.</em> <code class=\"language-text\">$ npm start</code>).</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/21a22d7712df71df3280597096b57cd4/e8aab/deploy-server-test.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 41.946308724832214%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAEDBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAD/9oADAMBAAIQAxAAAAHLrLygH//EABUQAQEAAAAAAAAAAAAAAAAAABBB/9oACAEBAAEFAof/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAY/An//xAAXEAEAAwAAAAAAAAAAAAAAAAABABAx/9oACAEBAAE/IWHa/9oADAMBAAIAAwAAABDz7//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAECAQE/ECf/xAAaEAACAgMAAAAAAAAAAAAAAAABEQAxECFh/9oACAEBAAE/EAvttSwdx//Z'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Test deploy workflow on the server (console screenshot)\"\n        title=\"\"\n        src=\"/static/21a22d7712df71df3280597096b57cd4/f8fb9/deploy-server-test.jpg\"\n        srcset=\"/static/21a22d7712df71df3280597096b57cd4/e8976/deploy-server-test.jpg 148w,\n/static/21a22d7712df71df3280597096b57cd4/63df2/deploy-server-test.jpg 295w,\n/static/21a22d7712df71df3280597096b57cd4/f8fb9/deploy-server-test.jpg 590w,\n/static/21a22d7712df71df3280597096b57cd4/e8aab/deploy-server-test.jpg 596w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>In the production environment, the deploy workflow on the server unzips the zipped build directory, performs a database backup, stops the runtime daemon process, migrates build files, updates node modules and starts the runtime daemon process. The production environment runtime is a native Windows service courtesy of the <a href=\"https://github.com/coreybutler/node-windows/\">node-windows</a> module.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9f16bae60443f98d918628117e70dd5d/e8aab/deploy-server-prod.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 87.41610738255034%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAARABQDASIAAhEBAxEB/8QAGAABAQADAAAAAAAAAAAAAAAAAAMBAgX/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAwH/2gAMAwEAAhADEAAAAeZOk7S1GqzDAP/EABYQAQEBAAAAAAAAAAAAAAAAABBBAf/aAAgBAQABBQKaTSH/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAUEAEAAAAAAAAAAAAAAAAAAAAw/9oACAEBAAY/Ah//xAAYEAACAwAAAAAAAAAAAAAAAAABEAAxwf/aAAgBAQABPyFhZqG1/9oADAMBAAIAAwAAABBf7z7/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EB//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAgEBPxAhP//EABwQAAICAwEBAAAAAAAAAAAAAAERACEQMXGRsf/aAAgBAQABPxAiiF8gEEv4sMopOAGb8wdI39x//9k='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Production deploy workflow on the server (console screenshot)\"\n        title=\"\"\n        src=\"/static/9f16bae60443f98d918628117e70dd5d/f8fb9/deploy-server-prod.jpg\"\n        srcset=\"/static/9f16bae60443f98d918628117e70dd5d/e8976/deploy-server-prod.jpg 148w,\n/static/9f16bae60443f98d918628117e70dd5d/63df2/deploy-server-prod.jpg 295w,\n/static/9f16bae60443f98d918628117e70dd5d/f8fb9/deploy-server-prod.jpg 590w,\n/static/9f16bae60443f98d918628117e70dd5d/e8aab/deploy-server-prod.jpg 596w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<hr>\n<h2>Feedback</h2>\n<p>Have questions, comments or suggestions? Reach out to me on Twitter (<a href=\"https://twitter.com/colinrcummings\">@colinrcummings</a>).</p>\n<p>— Colin</p>","frontmatter":{"title":"Managing environment workflows with gulp.js","date":"October 03, 2017"}}},"pageContext":{"slug":"/managing-environment-workflows-with-gulp/","previous":{"fields":{"slug":"/introduction-to-react/"},"frontmatter":{"title":"Introduction to React.js"}},"next":{"fields":{"slug":"/buttercup-password-manager/"},"frontmatter":{"title":"Buttercup Password Manager"}}}}